# Installation

## ngi_reports Python Package
To create reports you need to install the `ngi_reports` package.
First, either download or clone the [repository](https://github.com/SciLifeLab/ngi_reports).
Make sure that you include the `--recursive` flag:

```
git clone --recursive git@github.com:SciLifeLab/ngi_reports.git
```
_(remember to fork instead if you intend to make changes to the code)_

Next, install the package by running:

```
cd ngi_reports
python setup.py install
```

You also need to install the `pandocfilters` submodule:

```
cd data/pandoc_templates/pandocfilters/
python setup.py install
```

These commands should install all dependencies so that the python code is ready to run.
If you're intending to make changes to the code, use `develop` instead of `install`
so that you don't need to run the setup script each time you make a change.

Next, you need a config file in your home directory called
`~/.ngi_config/ngi_reports.conf`. This file should be formatted for 
[Python ConfigParser](https://docs.python.org/2/library/configparser.html)
and look like this:

```ini
[ngi_reports]
support_email: genomics_support@scilifelab.se
ngi_node: stockholm

[organism_names]
hg19: Human
hg18: Human
mm10: Mouse
mm9: Mouse
```

Obviously, if you're working at the Uppsala NGI node, change the `ngi_node` to
`uppsala` instead of `stockholm`. The `organism_names` section should have 
reference id key - text pairs. This is used to make the report more verbose.

## ngi_visualizations
The `ngi_reports` scripts use a separete Python module called `ngi_visualizations`.
You can find this repository along with installation instructions on github:
[ngi_visualizations](https://github.com/SciLifeLab/ngi_visualizations)

At the time of writing, the package could be installed as follows:

```bash
git clone git@github.com:SciLifeLab/ngi_visualizations.git
cd ngi_visualizations
python setup.py install
```


## Status DB
If you're running `ngi_reports` from the Stockholm NGI node, you'll need access
to Status DB. This is done using the [statusdb](https://github.com/SciLifeLab/statusdb)
python package. See that readme for installation instructions (it's very similar to the
above, but I don't want to duplicate it here in case it gets out of date).

## Pandoc Conversion
NGI reports use [Pandoc](http://johnmacfarlane.net/pandoc/)
to convert the autogenerated Markdown files into HTML and PDF reports.
Head to the [pandoc installation page](http://johnmacfarlane.net/pandoc/installing.html)
and download the appropriate version for your system. Make sure that you also
download and install LaTeX and all of the LaTeX packages that you can get your
hands on.

Note - nestor and milou UPPMAX nodes have pandoc installed, but a very old version.
This software has been build and tested with Pandoc v1.13.1 and won't work with
version 1.9.4.1 which is on UPPMAX. Thankfully the latest version can be installed manually
as follows:

```
..coming soon..
```

### Fonts
The LaTeX to PDF conversion uses two fonts - **Helvetica Neue** for headings
and body text, and **Consolas** for code. If you're using Mac OSX you can get
Consolas by following the instructions in
[this blog post](http://zjhzxhz.com/2014/01/install-microsofts-consolas-font-on-mac-os-x/).


## Bash Commands
To use `ngi_reports` from the command line easily, you need to add some lines
to your `~/.bashrc` file (`~/.bash_profile` on a mac):
**note that you need to change the `ngi_reports_dir` variable at the start..**

```
# NGI Reports
ngi_reports_dir=/CHANGE/THIS/PATH/TO/YOUR/ngi_reports
PATH=${ngi_reports_dir}/scripts:$PATH
function make_report {
	for f in "$@"; do
	  fn=${f%.md}
	  echo "Converting ${f}.."
	  PD_DIR=${ngi_reports_dir}/data/pandoc_templates
	  pandoc --standalone --section-divs ${fn}.md -o ${fn}.html --template=${PD_DIR}/html_pandoc.html --default-image-extension=png --filter ${PD_DIR}/pandoc_filters.py -V template_dir=${PD_DIR}/ 
	  pandoc --standalone ${fn}.md -o ${fn}.pdf --template=${PD_DIR}/latex_pandoc.tex --latex-engine=xelatex --default-image-extension=pdf --filter ${PD_DIR}/pandoc_filters.py -V template_dir=${PD_DIR}/ 
	done
}
export -f make_report
```